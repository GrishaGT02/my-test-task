{"version":3,"file":"bundle.js","mappings":"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","sources":["webpack://wysiwyg-editor/./src/index.js"],"sourcesContent":["import './styles.css';\n\ntinymce.init({\n  selector: '#editor',\n  menubar: false,\n  toolbar: false,\n  height: 500,\n  branding: false,\n  content_style: `\n    body { background: #fff; color: #222; font-size: 16px; }\n    select[data-template-dropdown=\"true\"] {\n      padding: 6px 16px;\n      border-radius: 6px;\n      border: 2px solid #5e5;\n      background: #222;\n      color: #fff;\n      font-size: 1em;\n      margin: 4px 8px 4px 0;\n      outline: none;\n      transition: border 0.2s, background 0.2s;\n      font-family: inherit;\n      min-width: 120px;\n      box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n    }\n    select[data-template-dropdown=\"true\"]:hover,\n    select[data-template-dropdown=\"true\"]:focus {\n      border: 2px solid #8f8;\n      background: #333;\n    }\n    select[data-template-dropdown=\"true\"]:focus option {\n      background: #444;\n      color: #fff;\n    }\n    .error {\n      display: inline-block;\n      padding: 6px 16px;\n      border-radius: 6px;\n      background: #e55;\n      color: #fff;\n      font-weight: bold;\n      margin: 4px 8px 4px 0;\n      font-size: 1em;\n      letter-spacing: 1px;\n      box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n    }\n  `,\n  setup: function(editor) {\n    editor.on('keydown', function(e) {\n      if (e.key === 'Delete') {\n        const rng = editor.selection.getRng();\n        if (rng.collapsed) {\n          let node = rng.startContainer;\n          let offset = rng.startOffset;\n          let next = null;\n          if (node.nodeType === 3) { // текстовый узел\n            // Если курсор в конце текста, ищем следующий элемент\n            if (offset === node.length) {\n              next = node.nextSibling;\n            }\n          } else if (node.nodeType === 1) { // элемент\n            next = node.childNodes[offset];\n          }\n          if (next && next.nodeName === 'SELECT' && next.getAttribute('data-template-dropdown') === 'true') {\n            next.remove();\n            e.preventDefault();\n          }\n        }\n      }\n    });\n  }\n});\n\n// --- Панель шаблонов ---\nfunction generateId() {\n  return '_' + Math.random().toString(36).substr(2, 9);\n}\n\nlet templates = [\n  { id: generateId(), text: 'template 1' },\n  { id: generateId(), text: 'template 2' },\n  { id: generateId(), text: 'template 3' }\n];\nlet selectedTemplateIndex = 0;\n\nconst templatesList = document.getElementById('templates-list');\nconst addBtn = document.getElementById('add-template');\nconst removeBtn = document.getElementById('remove-template');\nconst editInput = document.getElementById('edit-template-input');\n\nfunction renderTemplatesList() {\n  templatesList.innerHTML = '';\n  templates.forEach((tpl, i) => {\n    const li = document.createElement('li');\n    li.textContent = tpl.text;\n    li.className = (i === selectedTemplateIndex) ? 'selected' : '';\n    li.onclick = () => {\n      selectedTemplateIndex = i;\n      renderTemplatesList();\n      renderEditInput();\n    };\n    templatesList.appendChild(li);\n  });\n}\n\nfunction renderEditInput() {\n  if (templates[selectedTemplateIndex] !== undefined) {\n    editInput.value = templates[selectedTemplateIndex].text;\n    editInput.disabled = false;\n  } else {\n    editInput.value = '';\n    editInput.disabled = true;\n  }\n}\n\nfunction syncDropdownsInEditor() {\n  const editor = tinymce.activeEditor;\n  if (!editor) return;\n  const body = editor.getBody();\n  let changed = false;\n  // Собираем все select с data-template-dropdown\n  const selects = body.querySelectorAll('select[data-template-dropdown=\"true\"]');\n  selects.forEach(select => {\n    const selectedId = select.value;\n    const found = templates.find(t => t.id === selectedId);\n    if (!found) {\n      // Заменяем select на ERROR\n      const errorSpan = document.createElement('span');\n      errorSpan.className = 'error';\n      errorSpan.textContent = 'ERROR';\n      select.parentNode.replaceChild(errorSpan, select);\n      changed = true;\n    } else {\n      // Пересоздаём опции\n      const prevValue = select.value;\n      select.innerHTML = '';\n      templates.forEach((tpl) => {\n        const opt = document.createElement('option');\n        opt.value = tpl.id;\n        opt.textContent = tpl.text;\n        select.appendChild(opt);\n      });\n      select.value = prevValue;\n      changed = true;\n    }\n  });\n  if (changed) {\n    editor.nodeChanged(); // Обновить состояние редактора\n  }\n}\n\nfunction onTemplatesChanged() {\n  renderTemplatesList();\n  renderEditInput();\n  syncDropdownsInEditor();\n}\n\naddBtn.onclick = () => {\n  templates.push({ id: generateId(), text: 'template' });\n  selectedTemplateIndex = templates.length - 1;\n  onTemplatesChanged();\n};\n\nremoveBtn.onclick = () => {\n  if (templates.length === 0) return;\n  templates.splice(selectedTemplateIndex, 1);\n  if (selectedTemplateIndex >= templates.length) {\n    selectedTemplateIndex = templates.length - 1;\n  }\n  onTemplatesChanged();\n};\n\neditInput.addEventListener('keydown', (e) => {\n  if (e.key === 'Enter') {\n    saveEditInput();\n    editInput.blur();\n  }\n});\neditInput.addEventListener('blur', saveEditInput);\n\nfunction saveEditInput() {\n  if (templates[selectedTemplateIndex] !== undefined) {\n    templates[selectedTemplateIndex].text = editInput.value;\n    onTemplatesChanged();\n  }\n}\n\n// --- Вставка и синхронизация выпадающих списков ---\nfunction getTemplateDropdownHTML(selectedId = null) {\n  if (!templates.length) {\n    return '<span class=\"error\">ERROR</span>';\n  }\n  let options = templates.map((tpl) =>\n    `<option value=\"${tpl.id}\"${tpl.id === selectedId ? ' selected' : ''}>${tpl.text}</option>`\n  ).join('');\n  // Если selectedId не найден, не выставляем selected\n  return `<select data-template-dropdown=\"true\">${options}</select>`;\n}\n\nconst insertBtn = document.getElementById('insert-btn');\ninsertBtn.onclick = () => {\n  // Вставляем select с текущими шаблонами, по умолчанию выбран первый\n  const html = getTemplateDropdownHTML(templates[0] ? templates[0].id : null);\n  tinymce.activeEditor.execCommand('mceInsertContent', false, html);\n};\n\n// Инициализация\nonTemplatesChanged();\n"],"names":["generateId","Math","random","toString","substr","tinymce","init","selector","menubar","toolbar","height","branding","content_style","setup","editor","on","e","key","rng","selection","getRng","collapsed","node","startContainer","offset","startOffset","next","nodeType","length","nextSibling","childNodes","nodeName","getAttribute","remove","preventDefault","templates","id","text","selectedTemplateIndex","templatesList","document","getElementById","addBtn","removeBtn","editInput","renderTemplatesList","innerHTML","forEach","tpl","i","li","createElement","textContent","className","onclick","renderEditInput","appendChild","undefined","value","disabled","onTemplatesChanged","activeEditor","body","getBody","changed","querySelectorAll","select","selectedId","find","t","prevValue","opt","errorSpan","parentNode","replaceChild","nodeChanged","syncDropdownsInEditor","saveEditInput","push","splice","addEventListener","blur","html","arguments","options","map","concat","join","getTemplateDropdownHTML","execCommand"],"sourceRoot":""}